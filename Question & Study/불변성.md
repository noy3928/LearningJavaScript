# 불변성은 왜 중요한 것인가

불변성이 중요한 이유.
근데, 불변성이라는 단어를 사용하긴 하는데, 통상적으로 불변성이 중요하다라고 말할 때의 불변성은,
'불변객체'를 말하는 것이 아닐까. 그런생각이 들었다.
불변성만해도 2가지 의미가 나올 수 있기 때문에 이런 구분을 하는 것이 필요하다.  
데이터영역이 불변하다고 말할 수 있고, 객체가 불변하다고 말할 수 있기 때문이다.
아무튼, 불변성이 중요한 이유에 대해서 지금까지 공부한 내용들을 정리해내려가보자.

## 1.예측가능성

사실 예측 가능성 때문에 불변성이 중요하다고 말하지만, 조금 더 정확하게 말하려면  
'예측불가능성에 대한 예방'때문에 불변성이 중요한 것이 아닐까.

객체는 값을 담을 때, 값에 대한 참조를 통해 값을 담는다.  
이런 객체가 다른 변수에 복사되면, 두 변수는 같은 객체 주소값을 바라보고 있다.  
때문에 한 변수에서 property를 변형시키면, 두 변수 모두 변형된다.
근데, 이렇게 복사된 객체가 여러군데에 있다면?  
그리고 어딘가에서 변형이 일어난다면??
다른 모든 곳에서 변형이 일어날 것이다.

이렇게되면 우리는 예측하지 못하는 곳에서, 사이드이펙트를 맞이하게 될지도 모른다.  
때문에 우리는 기존의 객체로부터 새로운 값을 만들어내고자 한다면,
기존의 객체를 변형시킬 것이 아니라,  
새로운 객체를 만들어 값을 추가 혹은 변형하는 것이 나을 것이다.  
이렇게 함으로써, 우리는 예측할 수 없는 사이드 이펙트가 생기는 것을 예방할 수 있다.

<br>

## 2.변형에 대한 추적

불변성을 지켜나간다면, 우리는 변형에 대한 추적을 쉽게할 수 있다.
변형에 대한 추적이 필요한 경우는 언제인가? 리액트와 뷰 같이 virtual dom을 사용하는 경우,
기존의 값과 변화가 생긴 값에 대한 비교가 필요하다.  
이때, 기존의 값을 변형시키는 방식으로 작동된다면 비교하는 행위가 만만치 않을 것이다.  
아주 간단하게, 기존의 값을 내버려두고, 기존으로부터 새로 생긴 객체를 만든 다음 변화된 것만 비교할 수 있게 해주는 것이다.
(여기서 나의 궁금증. 새로운 객체를 만들어내는 것은 아예 다른 주소값을 가지게 될텐데, 이 두 가지를 비교하는 것은 쉬울까?? 내부적으로 이 비교는 어떤 방식으로 이루어지는 것일까? )
이외에도 git의 예를 들어볼 수 있다. 기존의 파일에서 새로운 변경사항을 커밋해나가면서 히스토리를 쌓아나간다. 이때 매번 새로운 객체를 만들어나감으로써, 우리는 기존의 객체들과 비교가능해진다.
또한 흔히 사용하는 Undo의 기능에서도 불변성은 사용될 수 있다. 기존에 해왔던 행동들에 대한 기록들이 남아있어야만 이전으로 돌아가기 기능이 원활하게 이루어질 수 있을 것이다. 기존의 객체를 변형시키는 방식으로 이루어졌다면, 매우 복잡하고, 머리아프고 많은 버그를 마주하게 될 수도 있는 것이다.

<br>

## 3.성능 문제

그런데, 사실 이런 객체의 불변성을 지키려다보면 성능상의 문제가 생길 수 있다.  
무슨 말이냐. 맨 처음에는 객체의 크기가 작아서 문제가 되지 않을 수도 있다.
그러나 어플의 크기가 점점 커지면서 객체의 크기도 한없이 커진다면, 그런데도 계속해서 새로운 객체를 만들어낸다면??
성능상의 문제는 쉽게 예측할 수 있는 것이다.  
이런 문제는 어떻게 해결하나?  
structure sharing이라는 기술을 통해서 해결할 수 있다.  
immutable.js라는 라이브러리에 내부적으로 구현되어 있는 기술이기도 한데,
내가 이해한 기본적인 골조는 다음과 같다. 새로운 객체를 만들되, 변화가 없는 내용들에 대해서는 기존의 값을 참조하도록 만든다는 것이다.  
기존의 값을 참조한다는 것은 변수영역에 대한 메모리 확보 외에는 메모리상에선 변화가 없다는 것이다.
(아직 이 내용은 확실하지 않음으로, structure sharing에 대해서는 더 많은 자료조사가 필요하다.)

아무튼 이런 방식으로 불변성에서 빚어질 수 있는 성능상의 문제도 해결할 수 있다.
