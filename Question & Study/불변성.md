# 불변성은 왜 중요한 것인가

불변성이 중요한 이유.
근데, 불변성이라는 단어를 사용하긴 하는데, 통상적으로 불변성이 중요하다라고 말할 때의 불변성은,
'불변객체'를 말하는 것이 아닐까. 그런생각이 들었다.
불변성만해도 2가지 의미가 나올 수 있기 때문에 이런 구분을 하는 것이 필요하다.  
데이터영역이 불변하다고 말할 수 있고, 객체가 불변하다고 말할 수 있기 때문이다.
아무튼, 불변성이 중요한 이유에 대해서 지금까지 공부한 내용들을 정리해내려가보자.

## 1.예측가능성

사실 예측 가능성 때문에 불변성이 중요하다고 말하지만, 조금 더 정확하게 말하려면  
'예측불가능성에 대한 예방'때문에 불변성이 중요한 것이 아닐까.

객체는 값을 담을 때, 값에 대한 참조를 통해 값을 담는다.  
이런 객체가 다른 변수에 복사되면, 두 변수는 같은 객체 주소값을 바라보고 있다.  
때문에 한 변수에서 property를 변형시키면, 두 변수 모두 변형된다.
근데, 이렇게 복사된 객체가 여러군데에 있다면?  
그리고 어딘가에서 변형이 일어난다면??
다른 모든 곳에서 변형이 일어날 것이다.

이렇게되면 우리는 예측하지 못하는 곳에서, 사이드이펙트를 맞이하게 될지도 모른다.  
때문에 우리는 기존의 객체로부터 새로운 값을 만들어내고자 한다면,
기존의 객체를 변형시킬 것이 아니라,  
새로운 객체를 만들어 값을 추가 혹은 변형하는 것이 나을 것이다.  
이렇게 함으로써, 우리는 예측할 수 없는 사이드 이펙트가 생기는 것을 예방할 수 있다.

<br>

## 2.변형에 대한 추적

불변성을 지켜나간다면, 우리는 변형에 대한 추적을 쉽게할 수 있다.
변형에 대한 추적이 필요한 경우는 언제인가? 리액트와 뷰 같이 virtual dom을 사용하는 경우,
기존의 값과 변화가 생긴 값에 대한 비교가 필요하다.  
이때, 기존의 값을 변형시키는 방식으로 작동된다면 비교하는 행위가 만만치 않을 것이다.  
아주 간단하게, 기존의 값을 내버려두고, 기존으로부터 새로 생긴 객체를 만든 다음 변화된 것만 비교할 수 있게 해주는 것이다.
(여기서 나의 궁금증. 새로운 객체를 만들어내는 것은 아예 다른 주소값을 가지게 될텐데, 이 두 가지를 비교하는 것은 쉬울까?? 내부적으로 이 비교는 어떤 방식으로 이루어지는 것일까? )
이외에도 git의 예를 들어볼 수 있다. 기존의 파일에서 새로운 변경사항을 커밋해나가면서 히스토리를 쌓아나간다. 이때 매번 새로운 객체를 만들어나감으로써, 우리는 기존의 객체들과 비교가능해진다.
또한 흔히 사용하는 Undo의 기능에서도 불변성은 사용될 수 있다. 기존에 해왔던 행동들에 대한 기록들이 남아있어야만 이전으로 돌아가기 기능이 원활하게 이루어질 수 있을 것이다. 기존의 객체를 변형시키는 방식으로 이루어졌다면, 매우 복잡하고, 머리아프고 많은 버그를 마주하게 될 수도 있는 것이다.

<br>

## 3.성능 문제

그런데, 사실 이런 객체의 불변성을 지키려다보면 성능상의 문제가 생길 수 있다.  
무슨 말이냐. 맨 처음에는 객체의 크기가 작아서 문제가 되지 않을 수도 있다.
그러나 어플의 크기가 점점 커지면서 객체의 크기도 한없이 커진다면, 그런데도 계속해서 새로운 객체를 만들어낸다면??
성능상의 문제는 쉽게 예측할 수 있는 것이다.  
이런 문제는 어떻게 해결하나?  
structure sharing이라는 기술을 통해서 해결할 수 있다.  
immutable.js라는 라이브러리에 내부적으로 구현되어 있는 기술이기도 한데,
내가 이해한 기본적인 골조는 다음과 같다. 새로운 객체를 만들되, 변화가 없는 내용들에 대해서는 기존의 값을 참조하도록 만든다는 것이다.  
기존의 값을 참조한다는 것은 변수영역에 대한 메모리 확보 외에는 메모리상에선 변화가 없다는 것이다.
(아직 이 내용은 확실하지 않음으로, structure sharing에 대해서는 더 많은 자료조사가 필요하다.)

아무튼 이런 방식으로 불변성에서 빚어질 수 있는 성능상의 문제도 해결할 수 있다.

<br>

## 불변성이 그렇게 중요하면, 불변성을 지키지 않는 사람들은 왜그런거야?

우선 불변성은 개발을 함에 있어 많은 문제들을 simple하게 만들어준다는 점에서 장점이 있다.  
그러나, mutable한 object를 여전히 사용하는 사람들에게도 여전히 그들만의 주장이 있었다.

### 1.성능문제

객체가 매우 크고 복잡할수록, 불변성을 지킨다는 이유로 객체를 새롭게 만들어내는 것은 성능상 굉장한 문제가 될 수 있다.  
게임캐릭터의 예시를 들어보자. 게임에서 스피드는 생명과 같다. 때문에 게임 내의 캐릭터의 HP가 올라가고 내려갈 때마다, 새로운 객체를 만들어내는 것은  
심각한 성능문제를 불러일으킬 것이다. 이런 경우에는 mutable 한 object를 이용하는 것이 더 효율적일지도 모른다.

### 2. 직관성

mutable한 object가 현실의 개념과 훨씬 부합한다는 주장이다. 자동차의 예를 들어보자. 자동차에 기름이 떨어져서, 기름을 채우고 있다.  
우리는 자동차에 기름을 채웠다고해서 그 자동차가 '새로운' 자동차라고 생각하지 않는다.  
기존의 자동차에 기름탱크라는 property의 값만이 바뀌었을 뿐이다.  
이런 관점에서 우리는 현실을 인지할 때 mutable한 방식으로 인지하고 있기 때문에, 이것이 더 직관적인 방법이라고 할 수 있을 것이다.

- 여기에 대해서는 또 재미있는 이야기가 있었다. closure는 애초에 mutable object를 지원하지 않는 언어인데, 이 언어의 창시자는 다음과 같은 주장을 한다는 것이다. 기름탱크에 기름이 1/4만 있던 '자동차'와, 1/2이 채워진 '자동차'는 더 이상 같은 자동차가 아니라는 의미다. 세상의 모든 것들이 연속적으로 이어져있다고 인지를 할 수도 있지만, 사실은 원자단위로 이루어져 결합되어 있다는 사실을 기억해야한다는 것이다. 똑같은 강은 두번다시 건널 수 없다는 주장과 같은 말인 듯 했다. 상당히 철학적인 이야기인 것 같은데, 재미있는 논쟁이었다.

### 3.관성

기존의 사람들은 불변성을 사용하지 않았다. 불변성의 개념이 트렌드가 되면서부터 많은 사람들이 불변성을 사용하기 시작했지만,  
이전의 사람들은 그렇지 않았다는 것이다. 변화를 받아들이는 것은 모든 사람들에게 마찬가지로 어려운 일이다.  
심지어, 기존에 작성된 코드들이 mutable한 코드들인데 그것을 갑자기 수정한다고하면 비용도 만만치 않을 것이다.

### 4.명령형 언어는 mutable이 default다.

명령형 언어들은 Mutable object가 default인 이유로 불변성을 지키지 않는다는 것이다.  
기본적으로 제공하는 것을 사용하지 않으려면, 그렇게 하지 않으려는 다른 부가적인 행동들이 필요하다.

<br>

## 도메인 주도 설계와 불변성?

immutability가 중요하다면 mutability가 들어설 자리는 없는걸까?  
이런 내용에 대해 검색을 해보다가 발견한 문장이 있었다.

> 도메인 주도 설계의 관점으로보면, 객체가 불변 해야할 때와 불변하지 않아도 될 때가 구분된다.  
> 그런데, 나는 아직 도메인 주도 설계가 무엇인지 모른다. 때문에 이것을 알아볼 필요가 있다.
> DDD와 불변성은 어떤 연관성을 가지고 있는가?

- 도메인 주도 설계에서 도메인은 뭔 뜻인가?
  - 도메인은 사용자가 사용하는 것을 의미한다.
    - 요리사가 소프트웨어에서 레시피 확인하기 위해 사용한다면, 레시피가 도메인이다.
    - 개발자가 조건문 하나를 가지고 고민하고 있다면 그 조건문이 도메인이다.
- 도메인 주도 설계는 사용자 없는 소프트웨어는 없다는 전제에서 출발한다.
  - 소프트웨어는 사용자가 사용해야 비로소 의미를 가진다.
  - 소프트웨어를 성공적으로 이끌기 위한 사고방식으로 이해하면 된다.
- OOP의 문제점?
  - 기술중심적인 설계다.
  - 현실의 개념을 개발로 구현하려는 노력이 더욱 이상과 멀어지게 만들었다.
- 도메인과 객체의 차이는?
  - 별 차이없다.
  - 약간의 차이가 있다면, 설명하는 범위에서 차이가 난다.
    - 객체는 구체화할 수 있는 특정 요소만을 표현
    - 도메인은 사용자가 사용하는 모든 것
    - 도메인은 사용자가 누구인가에 따라서 달라질 수 있다.
- ## 프로젝트에서의 도메인설계
